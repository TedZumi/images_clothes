{% extends 'base.html' %}

{% block title %}
Гардероб
{% endblock %}

{% block body %}
  <h1>Ваш гардероб</h1>
  <div class="wardrobe">
    <script>
    const personId = {{ person_id }};
    // Получаем массив clothes_id из Javascript
    const wardrobeIds = JSON.parse('{{ person_wardrobe | tojson }}');

    fetch('/api/v1/wardrobe/' + wardrobeIds.join(','))
      .then(response => response.json())
      .then(clothesData => {
        const wardrobeContainer = document.querySelector('.wardrobe');
        clothesData.forEach(clothesItem => {
          const itemDiv = document.createElement('div');
          itemDiv.classList.add('wardrobe-item');

          itemDiv.innerHTML = `
            <a href="/product_card/${clothesItem.clothes_id}" data-id="${clothesItem.clothes_id}">
              <img src="/static/clothes_image/${clothesItem.image}" alt="${clothesItem.type}">
            </a>
            <p>${clothesItem.category}</p>
            <p>${clothesItem.brend}</p>
            <button class="delete-button" data-id="${clothesItem.clothes_id}">Удалить из гардероба</button>
          `;

          wardrobeContainer.appendChild(itemDiv);
        });

        // Добавление обработчика событий для кликов на изображения
        wardrobeContainer.addEventListener('click', (event) => {
          if (event.target.tagName === 'IMG') {
            const anchor = event.target.closest('a');
            if (anchor) {
              const clothesId = anchor.dataset.id;
              window.location.href = `/product_card/${clothesId}`;
            }
          } else if (event.target.classList.contains('delete-button')) {
            const clothesId = event.target.dataset.id;
            // Отправляем AJAX запрос для удаления вещи из гардероба
            fetch(`/api/v1/wardrobe/delete/${clothesId}?person_id=${personId}`, { // Передача person_id в URL
              method: 'DELETE'
            })
              .then(response => {
                // ... (обработка ответа)
              });
          }
        });
      });
    </script>
  </div>

  <div class="sidebar">
    <ul>
      <li><a href="/profile">Личный кабинет</a></li>
      <li><a href="/wardrobe">Мой гардероб</a></li>
      <li><a href="#">Мои образы</a></li>
    </ul>
  </div>

{% endblock %}